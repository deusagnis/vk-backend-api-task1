# VK Internship Backend API - Task 1

Тестовое задание для стажировки VK по направлению Бэкенд-разработки статистики сообществ.

## Описание

В качестве основы приложения я использовал модификацию фреймворка Laravel из репозитория
_[mggflow/laravel-microservice-base](https://github.com/mggflow/laravel-microservice-base)_.

Код основной логики расположен в следующих файлах:

* app/Microservice/Controllers/EventController.php
* app/Microservice/Facades/EventAdding.php
* app/Microservice/Facades/EventDistributionSearch.php
* app/Microservice/Models/Event.php
* app/Microservice/Models/EventsDistribution.php
* app/Microservice/DistributeEvent.php

## Использование

Для работы с приложением необходимо отправить GET или POST запрос на соответствующий EndPoint с передачей необходимых
параметров.

### Добавление события

- Путь к методу: /api/vkinternship/backend-api/task1/event/add
- Обязательные параметры:
    - _name_ - название события.
        - Строка
        - Максимальная длина - 64 символа
- Необязательные параметры:
    - _userStatus_ - статус пользователя.
        - Число
        - Возможные значения: 0 или 1, где 0 - не авторизован и 1 - авторизован
- Возвращаемый результат:
    - JSON-кодированный объект вида: `{"result": <bool>}`, где `<bool>` - флаг успешного добавления События

### Получение статистики

- Путь к методу: /api/vkinternship/backend-api/task1/event/stat
- Обязательные параметры:
    - _name_ - название События.
        - Строка
        - Максимальная длина - 64 символа
    - _date_ - дата для выбора Событий.
        - Строка
        - Форматированное представление даты, например: d.m.Y или d-m-Y. Где d - день, m - месяц, Y - год
- Необязательные параметры:
    - _ip_ - IP-адрес пользователя Событий.
        - Строка
        - IP-адрес в формате ipv4 или ipv6
        - Максимальная длина - 39 символов
    - _userStatus_ - статус пользователя.
        - Число
        - Возможные значения: 0 или 1, где 0 - не авторизован и 1 - авторизован
- Возвращаемый результат:
    - JSON-кодированный объект вида: `{"result": <int>}`, где `<int>` - счетчик Событий, удовлетворяющих условиям

### Ошибки

В случае ошибки возвращается JSON-кодированный объект вида: `{"errors": <array>}`, где `<errors>` - массив возникших
ошибок.

## Демо

Демонстрация созданного приложения доступна по ссылке:
https://mggflow.in/t/vkbackendapitask1

P.S.: ссылка не прямая, т.к. по техническим причинам реальное расположение приложения может меняться.

## Комментарии - обратная связь

В задании указано описание 2-х методов API.
В случае второго метода у меня возникли сомнения по поводу того, чего конкретно требуется добиться в работе и каким
должен быть возвращаемый результат. Поэтому я трактовал задачу второго метода следующим образом:
необходимо получать счетчики событий относительно возможных параметров событий. При этом название и дата события
являются обязательными входящими данными + могут быть применены 3-и доп. агрегации в виде IP + Статуса Пользователя или
чего-то одного из указанного.

Таким образом получается, что у нас есть всего 4-е "типа" подсчета событий. С учетом того, что событий может быть очень
много и не указан контекст, определяющий необходимость получения точных данных для каждого события в отдельности, я
решил применить хеш-таблицу для предварительного подсчета возможных сочетаний параметров. Ее значения обновляются при
каждом добавлении события, составляя транзакцию.

Резюмируя выше сказанное я принял следующие решения:

* Мотив: сомнение в правильности объединять в один метод как бы два действия - сбор статистики и поиск конкретных
  записей событий. Следствие: второй метод реализует только выборку счетчиков.
* Мотив: оптимизация работы с БД. Следствие: применение хеш-таблицы предварительного подсчета групп событий,
  используя доп. место и немного замедляя операцию добавления нового события. Но ускоряя операцию получения
  распределения событий.
* Мотив: в задании используется термин "дата", а не "метка времени". Следствие: при подсчете событий используется дата в
  формате:"d-m-Y".
* Мотив: в задании указана дата в единственном числе ("..по дате.."). Следствие: данные получаются для конкретной даты,
  а не для периода.
* Мотив: не указана детализация информации о событиях. Следствие: события хранятся в таблице по отдельности.
* Мотив: совокупность выше упомянутых вопросов. Следствие: хватило элементарных запросов к БД, хотя есть
  предположение, что задание подразумевает использование более сложных, например, на основе оператора _GROUP BY_.
* Мотив: не указаны требования к документации и описанию кода. Следствие: я опустил применение модульного тестирования.
* Мотив: не указано требования к подробному описанию развертки. Следствие: в Readme указана только ссылка на
  непосредственно Demo, развернутое в контейнере Docker на домашнем сервере.

P.S.: относительно последних двух пунктов можно ознакомиться со следующим
репозиторием: _[aton-web-dev-test-task-1 ](https://github.com/deusagnis/aton-web-dev-test-task-1)_
